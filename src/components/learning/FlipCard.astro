---
/**
 * FlipCard â€” Premium 3D flip with front/back personality
 *
 * Front: white, 6px top bar (#36507A), centered question, flip hint
 * Back:  tinted #EEF3FA, darker bar (#22324D), left-aligned answer
 * Motion: rotateY 580ms, hover lift, shadow manipulation
 */
interface Props {
	front: string
	back?: string
}

const { front, back } = Astro.props
const cardId = `flip-${Math.random().toString(36).substr(2, 9)}`
---

<div class='flip-card-container mb-4' data-card-id={cardId}>
	<div class='flip-card' role='button' tabindex='0' aria-label='Flip card to reveal answer'>
		<div class='flip-card-inner'>
			<!-- Front -->
			<div class='flip-card-face flip-card-front'>
				<div class='fc-top-bar fc-bar-front'></div>
				<div class='fc-content fc-content-front'>
					<p class='fc-question'>{front}</p>
				</div>
				<div class='fc-hint fc-hint-front'>
					<svg width='14' height='14' viewBox='0 0 24 24' fill='none' aria-hidden='true'>
						<path
							d='M9 3h6l1 2h4a1 1 0 011 1v13a1 1 0 01-1 1H4a1 1 0 01-1-1V6a1 1 0 011-1h4l1-2z'
							fill='#36507A'
							opacity='0.5'></path>
						<path d='M15 13l-3-3-3 3' stroke='white' stroke-width='1.5' stroke-linecap='round'
						></path>
					</svg>
					<span>Flip</span>
				</div>
			</div>

			<!-- Back -->
			<div class='flip-card-face flip-card-back'>
				<div class='fc-top-bar fc-bar-back'></div>
				<div class='fc-content fc-content-back'>
					{
						back ? (
							<p class='fc-answer'>{back}</p>
						) : (
							<div class='fc-answer'>
								<slot />
							</div>
						)
					}
				</div>
				<div class='fc-hint fc-hint-back'>
					<svg width='14' height='14' viewBox='0 0 24 24' fill='none' aria-hidden='true'>
						<path d='M19 12H5' stroke='#36507A' stroke-width='1.8' stroke-linecap='round'></path>
						<path
							d='M12 5l-7 7 7 7'
							stroke='#36507A'
							stroke-width='1.8'
							stroke-linecap='round'
							stroke-linejoin='round'></path>
					</svg>
					<span>Back</span>
				</div>
			</div>
		</div>
	</div>
</div>

<style>
	.flip-card-container {
		perspective: 900px;
	}

	.flip-card {
		width: 100%;
		height: 220px;
		cursor: pointer;
		position: relative;
		border-radius: 14px;
		transition:
			transform 200ms cubic-bezier(0.4, 0, 0.2, 1),
			box-shadow 200ms cubic-bezier(0.4, 0, 0.2, 1);
		box-shadow:
			0 1px 4px rgba(34, 50, 77, 0.06),
			0 0 0 1px #d6e1f3;
	}

	.flip-card:hover {
		transform: translateY(-2px);
		box-shadow:
			0 6px 20px rgba(34, 50, 77, 0.1),
			0 0 0 1px #d6e1f3;
	}

	.flip-card:focus {
		outline: 2px solid #36507a;
		outline-offset: 2px;
		border-radius: 14px;
	}

	.flip-card-inner {
		position: relative;
		width: 100%;
		height: 100%;
		transition: transform 580ms cubic-bezier(0.2, 0.8, 0.2, 1);
		transform-style: preserve-3d;
	}

	.flip-card.flipping .flip-card-inner {
		filter: drop-shadow(0 0 0 transparent);
	}

	.flip-card.flipped .flip-card-inner {
		transform: rotateY(180deg);
	}

	/* Faces */
	.flip-card-face {
		position: absolute;
		width: 100%;
		height: 100%;
		backface-visibility: hidden;
		-webkit-backface-visibility: hidden;
		border-radius: 14px;
		display: flex;
		flex-direction: column;
		overflow: hidden;
		background: white;
	}

	.flip-card-front {
		background: #ffffff;
	}

	.flip-card-back {
		background: #eef3fa;
		transform: rotateY(180deg);
	}

	/* Top bars */
	.fc-top-bar {
		height: 6px;
		flex-shrink: 0;
	}

	.fc-bar-front {
		background: #36507a;
	}

	.fc-bar-back {
		background: #22324d;
	}

	/* Content areas */
	.fc-content {
		flex: 1;
		display: flex;
		align-items: center;
		padding: 1.25rem 1.5rem;
	}

	.fc-content-front {
		justify-content: center;
		text-align: center;
	}

	.fc-content-back {
		justify-content: flex-start;
		align-items: flex-start;
		text-align: left;
	}

	.fc-question {
		font-size: 1.05rem;
		font-weight: 650;
		color: #141821;
		line-height: 1.4;
		margin: 0;
	}

	.fc-answer {
		font-size: 0.92rem;
		font-weight: 400;
		color: #22324d;
		line-height: 1.65;
		margin: 0;
	}

	/* Hint labels */
	.fc-hint {
		position: absolute;
		bottom: 0.7rem;
		right: 0.9rem;
		display: flex;
		align-items: center;
		gap: 0.3rem;
		font-size: 0.72rem;
		font-weight: 600;
		letter-spacing: 0.02em;
		color: #36507a;
		opacity: 0.55;
		transition: opacity 200ms ease;
	}

	.flip-card:hover .fc-hint {
		opacity: 0.85;
	}

	/* Reduced motion: crossfade instead of 3D */
	@media (prefers-reduced-motion: reduce) {
		.flip-card:hover {
			transform: none;
		}

		.flip-card-inner {
			transition: none;
		}

		.flip-card-front {
			transition: opacity 250ms ease;
		}

		.flip-card-back {
			transform: none;
			opacity: 0;
			transition: opacity 250ms ease;
		}

		.flip-card.flipped .flip-card-inner {
			transform: none;
		}

		.flip-card.flipped .flip-card-front {
			opacity: 0;
		}

		.flip-card.flipped .flip-card-back {
			opacity: 1;
		}
	}
</style>

<script>
	function initFlipCards() {
		const cards = document.querySelectorAll('.flip-card')

		cards.forEach((card) => {
			const newCard = card.cloneNode(true) as HTMLElement
			card.parentNode?.replaceChild(newCard, card)

			const finalCard = newCard as HTMLElement

			const handleFlip = () => {
				finalCard.classList.add('flipping')
				finalCard.classList.toggle('flipped')

				setTimeout(() => {
					finalCard.classList.remove('flipping')
				}, 580)
			}

			finalCard.addEventListener('click', handleFlip)
			finalCard.addEventListener('keydown', (e) => {
				if (e.key === 'Enter' || e.key === ' ') {
					e.preventDefault()
					handleFlip()
				}
			})
		})
	}

	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', initFlipCards)
	} else {
		initFlipCards()
	}

	document.addEventListener('astro:page-load', initFlipCards)
</script>
