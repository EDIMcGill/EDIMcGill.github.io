---
import HeaderLink from '@/components/HeaderLink'
import MenuIcon from './icons/MenuIcon.astro'
import Search from '@/components/Search'
import ToggleTheme from './ToggleTheme.astro'
import { NAV_TABS } from '@/data/categories'

// Get current path for active tab highlighting
const currentPath = Astro.url.pathname
---

<!-- Skip to content link for accessibility -->
<a
	href='#main-content'
	class='sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 focus:z-[100] focus:bg-blue-600 focus:text-white focus:px-4 focus:py-2 focus:rounded-lg focus:shadow-lg'
>
	Skip to content
</a>

<!-- Sticky Header with subtle inner purple glow -->
<header
	id='main-header'
	class='sticky top-0 z-50 w-full bg-white/95 dark:bg-gray-900/95 backdrop-blur-md border-b border-purple-200/60 dark:border-purple-700/60 transition-all duration-300'
	style='box-shadow: inset 0 -1px 4px -1px rgba(147, 51, 234, 0.15);'
>
	<div class='mx-auto px-4 sm:px-6 lg:px-8'>
		<div class='flex items-center justify-between h-16'>
			<!-- Left: EDI McGill Logo/Title -->
			<div class='flex-shrink-0'>
				<a
					href='/'
					class='text-xl font-bold text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors'
				>
					EDI McGill
				</a>
			</div>

			<!-- Center: Main Navigation (Desktop) -->
			<nav class='hidden lg:flex items-center space-x-1' aria-label='Main navigation'>
				{
					NAV_TABS.map((tab) => {
						const isActive =
							currentPath === tab.href || (tab.href !== '/' && currentPath.startsWith(tab.href))
						return (
							<a
								href={tab.href}
								class={`nav-link px-4 py-2 rounded-lg text-sm font-semibold transition-all duration-200 relative group ${
									isActive
										? 'text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/30'
										: 'text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-gray-100 dark:hover:bg-gray-800'
								}`}
							>
								{tab.name}
								{/* Underline on hover */}
								<span
									class={`absolute bottom-0 left-0 w-full h-0.5 bg-blue-600 dark:bg-blue-400 transform origin-left transition-transform duration-200 ${
										isActive ? 'scale-x-100' : 'scale-x-0 group-hover:scale-x-100'
									}`}
								/>
							</a>
						)
					})
				}
			</nav>

			<!-- Right: Get Support + Search + Theme Toggle -->
			<div class='hidden lg:flex items-center gap-3'>
				<!-- Get Support Button -->
				<a
					href='/resources'
					class='px-4 py-2 text-sm font-semibold text-white bg-blue-600 dark:bg-blue-500 rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition-all hover:scale-105 shadow-sm'
				>
					Get Support
				</a>

				<!-- Search Icon with Tooltip -->
				<div class='relative group'>
					<Search />
					<span
						class='absolute -bottom-10 left-1/2 -translate-x-1/2 px-2 py-1 text-xs bg-gray-900 dark:bg-gray-700 text-white rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none'
					>
						Search
					</span>
				</div>

				<!-- Theme Toggle with Tooltip -->
				<div class='relative group'>
					<ToggleTheme />
					<span
						class='absolute -bottom-10 left-1/2 -translate-x-1/2 px-2 py-1 text-xs bg-gray-900 dark:bg-gray-700 text-white rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none'
					>
						Toggle theme
					</span>
				</div>
			</div>

			<!-- Mobile Menu Button -->
			<div class='flex lg:hidden items-center gap-3'>
				<Search />
				<ToggleTheme />
				<button
					id='mobile-menu-button'
					type='button'
					class='p-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors'
					aria-label='Toggle menu'
					aria-expanded='false'
				>
					<MenuIcon />
				</button>
			</div>
		</div>
	</div>

	<!-- Mobile Navigation Menu -->
	<div
		id='mobile-menu'
		class='lg:hidden hidden border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900'
	>
		<nav class='px-4 py-4 space-y-2' aria-label='Mobile navigation'>
			{
				NAV_TABS.map((tab) => {
					const isActive =
						currentPath === tab.href || (tab.href !== '/' && currentPath.startsWith(tab.href))
					return (
						<a
							href={tab.href}
							class={`block px-4 py-3 rounded-lg text-base font-semibold transition-colors ${
								isActive
									? 'text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/30'
									: 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800'
							}`}
						>
							{tab.name}
						</a>
					)
				})
			}
			<a
				href='/resources'
				class='block px-4 py-3 text-base font-semibold text-white bg-blue-600 dark:bg-blue-500 rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors text-center'
			>
				Get Support
			</a>
		</nav>
	</div>
</header>

<script>
	// Mobile menu toggle
	const mobileMenuButton = document.getElementById('mobile-menu-button')
	const mobileMenu = document.getElementById('mobile-menu')

	mobileMenuButton?.addEventListener('click', () => {
		const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true'
		mobileMenuButton.setAttribute('aria-expanded', String(!isExpanded))
		mobileMenu?.classList.toggle('hidden')
	})

	// Add subtle inner purple glow to header on scroll
	const header = document.getElementById('main-header')
	let lastScroll = 0

	window.addEventListener('scroll', () => {
		const currentScroll = window.scrollY

		if (currentScroll > 20) {
			// Slightly enhanced inner purple glow on scroll
			header?.setAttribute('style', 'box-shadow: inset 0 -2px 6px -1px rgba(147, 51, 234, 0.25);')
		} else {
			// Return to default subtle inner purple glow
			header?.setAttribute('style', 'box-shadow: inset 0 -1px 4px -1px rgba(147, 51, 234, 0.15);')
		}

		lastScroll = currentScroll
	})
</script>

<style>
	/* Enhanced focus states for accessibility */
	.nav-link:focus-visible {
		outline: 2px solid theme('colors.blue.600');
		outline-offset: 2px;
	}
</style>
