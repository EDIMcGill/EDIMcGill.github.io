---
/**
 * Programs Page - EDI McGill
 *
 * Landing page for Events & Workshops
 * Displays upcoming and past events + auto-includes blog posts with category "Events & Workshops"
 */
import BaseLayout from '@/layouts/BaseLayout'
import TitlePage from '@/components/TitlePage'
import { getCollection } from 'astro:content'
import PostCard from '@/components/PostCard'
import { Image } from 'astro:assets'
import FormattedDate from '@/components/FormattedDate'

const title = 'Programs & Events'
const description = 'Explore EDI workshops, events, and learning opportunities at McGill University'

// Fetch events from the events collection
let upcomingEvents: any[] = []
let pastEvents: any[] = []

try {
	const allEvents = await getCollection('events', ({ data }) => !data.draft)
	const now = new Date()

	// Sort events by date
	upcomingEvents = allEvents
		.filter((event) => event.data.eventDate && new Date(event.data.eventDate) >= now)
		.sort((a, b) => new Date(a.data.eventDate!).getTime() - new Date(b.data.eventDate!).getTime())

	pastEvents = allEvents
		.filter((event) => !event.data.eventDate || new Date(event.data.eventDate) < now)
		.sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime())
} catch (error) {
	console.log('Events collection not yet populated')
}

// Auto-fetch blog posts with category "Events & Workshops"
let programPosts: any[] = []
try {
	const allBlogPosts = await getCollection('blog', ({ data }) => !data.draft)
	programPosts = allBlogPosts
		.filter((post) => post.data.category === 'Events & Workshops')
		.sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime())
} catch (error) {
	console.log('Error fetching blog posts:', error)
}
---

<BaseLayout title={title} description={description}>
	<!-- Page header with accent line -->
	<div class='mb-8'>
		<h1 class='text-2xl md:text-3xl font-semibold mb-4 leading-snug' style='color: #111827;'>
			{title}
		</h1>

		<!-- Description with accent line - vibrant colors -->
		<div class='flex items-start gap-3'>
			<div
				class='w-1 h-auto min-h-[60px] rounded-full flex-shrink-0'
				style='background: linear-gradient(to bottom, #E05A1A, #F2C94C);'
			>
			</div>
			<div class='flex-1'>
				<p class='text-base leading-loose' style='color: #374151;'>
					Join us for engaging workshops, seminars, and events designed to promote equity,
					diversity, and inclusion at McGill. Learn, connect, and make a difference.
				</p>
			</div>
		</div>
	</div>

	{
		upcomingEvents.length > 0 && (
			<section class='mb-12'>
				<h2 class='text-2xl font-bold mb-6 dark:text-white'>Upcoming Events</h2>
				<div class='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6'>
					{upcomingEvents.map((event) => (
						<PostCard post={event} />
					))}
				</div>
			</section>
		)
	}

	{
		pastEvents.length > 0 && (
			<section class='mb-12'>
				<h2 class='text-2xl font-bold mb-6 dark:text-white'>Past Events</h2>
				<div class='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6'>
					{pastEvents.map((event) => (
						<PostCard post={event} />
					))}
				</div>
			</section>
		)
	}

	<!-- Program Highlights Section - Vibrant playcard (teal theme for programs) -->
	{
		programPosts.length > 0 && (
			<div
				class='rounded-2xl p-1.5 mb-6 -mx-5 sm:-mx-8 md:-mx-0'
				style='background: linear-gradient(135deg, rgba(77, 184, 196, 0.20), rgba(77, 184, 196, 0.12)); box-shadow: 0 10px 32px rgba(77, 184, 196, 0.32), 0 0 0 1px rgba(77, 184, 196, 0.14);'
			>
				<div class='rounded-xl p-6 md:p-8' style='background: rgba(255, 255, 255, 0.65);'>
					<div class='flex items-start gap-2 mb-3'>
						<div
							class='w-1 h-6 rounded-full flex-shrink-0 mt-1'
							style='background: linear-gradient(to bottom, #4DB8C4, #E05A1A);'
						/>
						<h2 class='text-lg md:text-xl font-semibold leading-relaxed' style='color: #111827;'>
							Program Highlights
						</h2>
					</div>
					<p class='text-sm mb-6 leading-loose' style='color: #374151;'>
						Learn about our workshops, seminars, and events promoting EDI at McGill.
					</p>
					<div class='grid grid-cols-1 md:grid-cols-2 gap-6'>
						{programPosts.map((post) => (
							<a
								href={`/post/${post.slug}`}
								class='group bg-white dark:bg-gray-800/50 rounded-xl overflow-hidden hover:bg-gray-50 dark:hover:bg-gray-800/70 transition-colors'
								style='box-shadow: 0 6px 18px rgba(77, 184, 196, 0.15);'
							>
								<div class='aspect-[16/10] overflow-hidden'>
									<Image
										src={post.data.heroImage}
										alt={post.data.title}
										width={600}
										height={375}
										class='w-full h-full object-cover group-hover:scale-105 transition-transform duration-500'
									/>
								</div>
								<div class='p-5'>
									<div class='flex items-center gap-3 mb-2'>
										<span
											class='px-3 py-1 rounded-lg text-xs font-medium'
											style='background: rgba(77, 184, 196, 0.15); color: #0F4C5C;'
										>
											Programs
										</span>
										<FormattedDate date={post.data.pubDate} class='text-xs' />
									</div>
									<h3
										class='text-base md:text-lg font-semibold mb-2 leading-snug'
										style='color: #1F2937;'
									>
										{post.data.title}
									</h3>
									<p class='text-sm line-clamp-3 leading-relaxed' style='color: #5F6368;'>
										{post.data.description}
									</p>
									<div
										class='mt-3 text-sm inline-block no-underline group-hover:underline font-medium'
										style='color: #4DB8C4; text-decoration-color: rgba(77, 184, 196, 0.3);'
									>
										Read more
									</div>
								</div>
							</a>
						))}
					</div>
				</div>
			</div>
		)
	}

	{
		upcomingEvents.length === 0 && pastEvents.length === 0 && programPosts.length === 0 && (
			<div class='text-center py-12 text-gray-600 dark:text-gray-400'>
				<p class='text-lg'>No events currently scheduled. Check back soon for updates!</p>
			</div>
		)
	}
</BaseLayout>

<style>
	.line-clamp-3 {
		display: -webkit-box;
		-webkit-line-clamp: 3;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
</style>
