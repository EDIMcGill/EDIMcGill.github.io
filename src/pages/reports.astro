---
/**
 * Reports Page - EDI McGill
 *
 * EDI research, annual reports, and data
 */
import BaseLayout from '@/layouts/BaseLayout'
import TitlePage from '@/components/TitlePage'
import { getCollection } from 'astro:content'
import PostCard from '@/components/PostCard'

const title = 'Reports & Research'
const description = 'Access EDI reports, research, and data from McGill University'

// Fetch reports from the reports collection
let reports: any[] = []
let reportsByYear: Record<number, any[]> = {}

try {
	const allReports = await getCollection('reports', ({ data }) => !data.draft)

	// Sort by date
	reports = allReports.sort(
		(a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
	)

	// Group by year
	reports.forEach((report) => {
		const year = report.data.reportYear || new Date(report.data.pubDate).getFullYear()
		if (!reportsByYear[year]) {
			reportsByYear[year] = []
		}
		reportsByYear[year].push(report)
	})
} catch (error) {
	console.log('Reports collection not yet populated')
}

const years = Object.keys(reportsByYear)
	.map(Number)
	.sort((a, b) => b - a)
---

<BaseLayout title={title} description={description}>
	<!-- Page header with accent line -->
	<div class='mb-8'>
		<h1 class='text-2xl md:text-3xl font-semibold mb-4 leading-snug' style='color: #111827;'>
			{title}
		</h1>

		<!-- Description with accent line - vibrant colors -->
		<div class='flex items-start gap-3'>
			<div
				class='w-1 h-auto min-h-[60px] rounded-full flex-shrink-0'
				style='background: linear-gradient(to bottom, #F2C94C, #5B2D8B);'
			>
			</div>
			<div class='flex-1'>
				<p class='text-base leading-loose' style='color: #374151;'>
					Explore research, annual reports, and data related to equity, diversity, and inclusion at
					McGill University. These reports inform our strategies and track our progress.
				</p>
			</div>
		</div>
	</div>

	{
		years.length > 0 ? (
			<div class='space-y-12'>
				{years.map((year) => (
					<section>
						<h2 class='text-2xl font-bold mb-6 dark:text-white'>{year} Reports</h2>
						<div class='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6'>
							{reportsByYear[year].map((report) => (
								<PostCard post={report} />
							))}
						</div>
					</section>
				))}
			</div>
		) : (
			<div class='text-center py-12 text-gray-600 dark:text-gray-400'>
				<p class='text-lg'>Reports are being compiled. Check back soon!</p>
			</div>
		)
	}

	<section class='mt-12 prose dark:prose-invert mx-auto'>
		<h2>About Our Reports</h2>
		<p>
			Our reports provide transparent insights into EDI initiatives, challenges, and progress at
			McGill. We publish annual reports, research findings, and data analyses to inform
			decision-making and track our impact.
		</p>
	</section>
</BaseLayout>
